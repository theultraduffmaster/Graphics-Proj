 <!DOCTYPE html>
<html>
  <head>
    <head>
	<meta charset="UTF-8">
	<title>Pong</title>

    <style type="text/css"></style>
  </head>
  <body>
    <script type="text/javascript">
                  
var

/**
 * Constants for the entire game
 */
WIDTH  = 1300,
HEIGHT = 550,

pi = Math.PI,

UpArrow   = 38,
DownArrow = 40,

/**
 * reusable game functions
 */
canvas,
ctx,
keystate,

/**
 * The controllable player paddle
 */
player = {
	x: null,
	y: null,

	width:  18,
	height: 90,

	/**
	 * Move as told to by the arrow commands
	 */
	update: function() {
		if (keystate[UpArrow]) this.y -= 7;
		if (keystate[DownArrow]) this.y += 7;
		// Ensure the paddle stays inside of the canvas at all times
		this.y = Math.max(Math.min(this.y, HEIGHT - this.height), 0);
	},
    /**
	 * function to draw the player's paddle onto the canvas
	 */
	draw: function() {
		ctx.fillRect(this.x, this.y, this.width, this.height);
        
	}
},

/**
 * The paddle that will be controlled by the ai
 * 
 */
ai = {
	x: null,
	y: null,

	width:  18,
	height: 90,

	/**
	 * Reset the ai paddle depending on the position of the ball to optimize the challenge
	 */
	update: function() {
		// function to calculate the ideal position in regards to the ball
		var desty = ball.y - (this.height - ball.side)*0.5;
		// slow the movement towards this ideal position
		this.y += (desty - this.y) * 0.1;
		// Ensure the ai does not leave the canvas
		this.y = Math.max(Math.min(this.y, HEIGHT - this.height), 0);
	},

	/**
	 * Function to draw the ai paddle to the canvas
	 */
	draw: function() {
		ctx.fillRect(this.x, this.y, this.width, this.height);

	}
},
/**	
 * The tennis ball object
 * 
 */
ball = {
	x:   null,
	y:   null,
	vel: null,
    
    
	side:  10,
	speed: 16,
/**
	 * Serve the ball towards a specified side
	 * 
	 */
	serve: function(side) {
		// set the x and y position of the serve
		var r = Math.random();
		this.x = side===1 ? player.x+player.width : ai.x - this.side;
		this.y = (HEIGHT - this.side)*r;
		/* calculate the angles,  higher/lower on the y-axis = steeper angle i.e. catching the ball on the right or left side of the paddle will give more velocity rather than the center of the paddle
        */
		var phi = 0.1*pi*(1 - 2*r);
		// update the velocity, direction and magnitude
		this.vel = {
			x: side*this.speed*Math.cos(phi),
			y: this.speed*Math.sin(phi)
		}
	},

	/**
	 * Update the ball's position and ensure it stays within the canvas
	 */
	update: function() {
		// update the position with new velocity
		this.x += this.vel.x;
		this.y += this.vel.y;
		// check if within the boundaries on the y axis
		if (0 > this.y || this.y+this.side > HEIGHT) {
			// calculate how inside of the canvas the ball is
			var offset = this.vel.y < 0 ? 0 - this.y : HEIGHT - (this.y+this.side);
			this.y += 2*offset;
			// matches the y velocity
			this.vel.y *= -1;
		}
		// a function to check intesection between two axis aligned bounding boxes (AABB we'll call it for now)
		var AABBIntersect = function(ax, ay, aw, ah, bx, by, bw, bh) {
			return ax < bx+bw && ay < by+bh && bx < ax+aw && by < ay+ah;
		};
        // checks against the target paddle to check collision on the x axis
		var pdle = this.vel.x < 0 ? player : ai;
		if (AABBIntersect(pdle.x, pdle.y, pdle.width, pdle.height,
				this.x, this.y, this.side, this.side)
		) {	
            // sets the x position and calculate the angle of the ball
			this.x = pdle===player ? player.x+player.width : ai.x - this.side;
			var n = (this.y+this.side - pdle.y)/(pdle.height+this.side);
			var phi = 0.25*pi*(2*n - 1); // piÃ·4 = 45
			// calculate the smash (intensity) value and update the velocity accordingly
			var smash = Math.abs(phi) > 0.2*pi ? 1.5 : 1;
			this.vel.x = smash*(pdle===player ? 1 : -1)*this.speed*Math.cos(phi);
			this.vel.y = smash*this.speed*Math.sin(phi);
		}


    </script>
  </body>
</html>